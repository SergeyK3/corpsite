# ADR-004 — Org Units: CRUD и управление состоянием (B4)

## Статус
Принято

## Дата
2026-01-24

## Контекст

В рамках разработки системы Directory требуется завершить управление
оргструктурой как независимым справочником.

На предыдущих этапах (B1–B3) была реализована:
- модель `org_units` с иерархией `parent_unit_id`;
- чтение дерева подразделений;
- базовая стабилизация API и UI.

Отсутствовала зафиксированная архитектурная граница между:
- управлением оргструктурой;
- бизнес-логикой задач, ролей и KPI.

Это создавало риск преждевременного усложнения системы и нестабильности контрактов.

## Решение

Принять B4 как **изолированный архитектурный блок**, отвечающий исключительно за:
- CRUD подразделений;
- управление состоянием (`is_active`);
- корректную иерархию без циклов;
- минимальный и предсказуемый RBAC.

Блок B4 **не зависит** от задач, сотрудников и процессных ролей.

## Область ответственности

B4 управляет только структурой подразделений:
- иерархия (parent / children);
- жизненный цикл подразделения;
- безопасное редактирование дерева.

## Функциональный объём

### Создание подразделений
- создание корневых и дочерних узлов;
- обязательное поле `name`;
- `is_active = true` по умолчанию;
- запрет циклических связей.

### Переименование
- изменение только поля `name`;
- `unit_id` неизменяем;
- фиксация аудита (кто и когда).

### Перемещение
- изменение `parent_unit_id`;
- строгая проверка на циклы;
- сохранение всех дочерних узлов;
- сотрудники не затрагиваются.

### Активация / деактивация
- soft-delete через `is_active`;
- inactive-подразделения скрыты по умолчанию;
- отображаются при `include_inactive=true`;
- дочерние подразделения не изменяются автоматически.

## API-контракт

