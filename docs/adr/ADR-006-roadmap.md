# ADR-006: Roadmap — переход от Events/Notifications к Личным кабинетам (ЛК)

**Статус:** Accepted  
**Дата:** 2026-01-11  
**Контекст:** Corpsite (Tasks / Events / Telegram Bot / Web UI)

---

## 1. Контекст и цель

К моменту принятия данного ADR завершён и стабилизирован блок **Events / Notifications**:

- Реализована доставка событий через Telegram
- Зафиксирован UX-контракт сообщений
- Пройден e2e-сценарий:
  - `report → approve`
  - `report → reject → report → approve`
- Реализовано хранение курсора событий (audit_id / event_id)
- Поведение подтверждено на двух клиентах (ПК + планшет)

Цель данного ADR — **зафиксировать решение не продолжать шлифовку блока Events прямо сейчас**, а перейти к следующему крупному этапу системы — **Личным кабинетам (ЛК)**.

---

## 2. Принятое решение

### 2.1. Блок Events / Notifications

Блок считается **functional complete** и **заморожен**.

Дополнительные улучшения **не отменяются**, но **откладываются** в backlog и не входят в текущую фазу разработки.

#### Отложенные улучшения (Backlog)
- **A. UX-шлифовка текстов**
  - расширение формулировок
  - локализация / унификация между Telegram и Web UI
- **B. Автотесты e2e**
  - сценарии доставки событий
  - проверка курсоров и повторных запусков
- **C. Расширение типов событий**
  - новые event_type, связанные с будущими действиями в ЛК

Возврат к этим пунктам возможен **после появления Web UI**, чтобы UX и тесты были согласованы между каналами.

---

## 3. Следующий крупный шаг: Step 3 — Личные кабинеты (ЛК v1)

### 3.1. Цель Step 3

Создать минимально достаточный **Web-интерфейс**, позволяющий:

- Работать с задачами без Telegram
- Использовать уже существующий backend-контур (Tasks / Events / Actions)
- Подготовить основу для дальнейшего расширения системы

---

## 4. Scope ЛК v1 (минимальный, обязательный)

### Экран 1: «Мои задачи»
- Список задач пользователя
- Отображение:
  - task_id
  - title
  - status
- Фильтрация по статусу
- Пагинация / лимиты
- Отображение `allowed_actions`

### Экран 2: «Карточка задачи»
- Полная информация по задаче
- История событий (`/tasks/{id}/events`)
- Доступные действия:
  - report
  - approve
  - reject
  - update (если разрешено)

### Экран 3: «Профиль / привязки» (опционально)
- Может быть реализован позже
- Telegram bindings на первом этапе остаются без UI

---

## 5. Backend-инварианты для ЛК v1

Перед началом UI-разработки считаются обязательными:

1. `GET /tasks`
   - фильтрация по `status_code`
   - limit / offset (или cursor)
2. `GET /tasks/{id}`
3. `GET /tasks/{id}/events`
4. `POST /tasks/{id}/actions/{report|approve|reject}`
5. Единый формат ошибок (зафиксирован ADR-003)

Backend уже удовлетворяет этим требованиям.

---

## 6. Аутентификация и доступ

На этапе **ЛК v1** допускается упрощённая схема:

- Использование заголовка `X-User-Id`
- Без полноценной JWT / OAuth

Полноценная авторизация:
- выносится в **отдельный будущий шаг**
- не блокирует старт ЛК v1

---

## 7. Пользовательские роли (v1)

Минимальный набор ролей:

- Исполнитель
- Руководитель
- Заместитель

Роль «Директор» и расширенные сценарии — **вне текущего scope**.

---

## 8. Критерий завершения Step 3 (Definition of Done)

Step 3 считается завершённым, когда:

- Пользователь может:
  - увидеть список задач в Web UI
  - открыть карточку задачи
  - выполнить разрешённые действия
- Поведение Web UI полностью соответствует backend-инвариантам
- Telegram и Web UI работают параллельно, не конфликтуя

---

## 9. Последовательность roadmap

1. **Step 2 (текущий):**
   - e2e-проверка Events / Notifications
   - Go / No-Go
2. **Step 3:**
   - ЛК v1 (API + UI-каркас)
3. **Step 4 (будущий):**
   - Авторизация
   - UX-шлифовка
   - Автотесты
   - Расширение событий

---

## 10. Итог

Принято решение:
- **Не полировать Events сейчас**
- **Перейти к созданию Личных кабинетов**
- Считать Events стабильным фундаментом системы

Дальнейшие изменения блока Events допускаются **только через новый ADR**.
